jQuery(function(s){stfsk.init(),prestashop.on("updateProductList",function(t){stfsk.init()}),s(document).on("change",".st_lower_input,.st_upper_input",function(){var t=s(this).val(),e=s(this).closest(".st-range-box").find(".st-range"),a=e.data("jiazhong");t=stfsk.deFormatPrice(t,a),s(this).hasClass("st_lower_input")?e[0].noUiSlider.set([t,null]):e[0].noUiSlider.set([null,t])})});var stfsk={init:function(){$.each(this.jiazhong,function(t,e){e.format.symbles.length||stfsk.learnFormat(t)}),this.run()},jiazhong:{price:{url:"",format:{prefix:"",suffix:"",symbles:[],sample:"",decimals:2}},weight:{url:"",format:{prefix:"",suffix:"",symbles:[],sample:"",decimals:6}}},run:function(){this.init_slide()},init_slide:function(){$.each(this.jiazhong,function(a,t){var e=$('.st-range[data-jiazhong="'+a+'"]');e.length&&$.each(e,function(t,e){stfsk.chushihua(a,e)})});var t=$('.st-range[data-jiazhong="rangeslider"]');t.length&&$.each(t,function(t,e){stfsk.chushihua("rangeslider",e)})},chushihua:function(e,t){var a=!1,s=$(t),r=[],n=[];1==stfacetdsearchkits.with_inputs&&"rangeslider"!=e?n=[s.closest(".st-range-box").find(".st_lower_input"),s.closest(".st-range-box").find(".st_upper_input")]:r=[s.closest(".st-range-box").find(".value-lower"),s.closest(".st-range-box").find(".value-upper")];var i=s.data("url"),o=[],f={start:[parseFloat(s.data("lower")),parseFloat(s.data("upper"))],connect:!0},c="",l="";if(1!=stfacetdsearchkits.tooltips||"weight"!=e&&"price"!=e||$.extend(f,{tooltips:[stfsk.fomater[e],stfsk.fomater[e]]}),1==stfacetdsearchkits.vertical&&$.extend(f,{orientation:"vertical"}),"weight"==e)$.extend(f,{range:{min:[parseFloat(s.data("min"))],max:[parseFloat(s.data("max"))]},format:{to:function(t){return void 0!==t&&t.toFixed(stfsk.jiazhong[e].format.decimals)},from:Number}}),0<stfacetdsearchkits.weight_step&&$.extend(f,{step:stfacetdsearchkits.weight_step});else if("price"==e)0<stfacetdsearchkits.price_step&&$.extend(f,{step:stfacetdsearchkits.price_step}),$.extend(f,{range:{min:[parseFloat(s.data("min"))],max:[parseFloat(s.data("max"))]},format:{to:function(t){return void 0!==t&&t.toFixed(stfsk.jiazhong[e].format.decimals)},from:Number}});else if("rangeslider"==e){var h=s.data("values")+"";if(c=s.data("suffix"),l=s.data("prefix"),h&&-1!=h.indexOf(",")){o=s.data("values").split(","),$.each(o,function(t,e){o[t]=parseFloat(e,10)});var d={},g=o.length,m=o[0],u=o[g-1];if($.each(o,function(t,e){t=0==t?"min":t==g-1?"max":((e-m)/(u-m)*100).toFixed(2)+"%",d[t]=[e]}),$.extend(f,{snap:!0,range:d}),1==stfacetdsearchkits.tooltips){var p={to:function(t){return void 0!==t&&l+t+c},from:Number};$.extend(f,{tooltips:[p,p]})}}else a=!0}if("1"==prestashop.language.is_rtl&&$.extend(f,{direction:"rtl"}),!a){noUiSlider.create(s[0],f),s[0].noUiSlider.on("update",function(a,s){var i="";"rangeslider"==e?($.each(o,function(t,e){if(a[s]==e)return i=e,!1}),i||(i=a[s]),i=l+i+c):i=stfsk.formatPrice(a[s],e),1==stfacetdsearchkits.with_inputs&&"rangeslider"!=e?n[s].val(i):r[s].html(i)});var x="",k="";s[0].noUiSlider.on("start",function(t,e){x=t[0],k=t[1]}),s[0].noUiSlider.on("set",function(a,t){var s="";a[0]==x&&a[1]==k||(s+=i,"rangeslider"==e?$.each(o,function(t,e){e>=a[0]&&e<=a[1]&&(s+="-"+l+e+c)}):s+="-"+a[0]+"-"+a[1]),s&&prestashop.emit("updateFacets",s)})}},fomater:{weight:{to:function(t){return void 0!==t&&stfsk.formatPrice(t.toFixed(stfsk.jiazhong.weight.format.decimals),"weight")},from:Number},price:{to:function(t){return void 0!==t&&stfsk.formatPrice(t.toFixed(stfsk.jiazhong.price.format.decimals),"price")},from:Number}},learnFormat:function(t){var e=new RegExp("^([^\\d]*).*?([^\\d]*)$"),a=stfacetdsearchkits.sample[t],s=stfacetdsearchkits.sample[t],i=e.exec(a);i&&(i[1]&&(stfsk.jiazhong[t].format.prefix=i[1],s=s.replace(i[1],"")),i[2]&&(stfsk.jiazhong[t].format.suffix=i[2],s=s.replace(i[2],"")));var r;for(e=/([^\d])?(\d+)/g;r=e.exec(s);)stfsk.jiazhong[t].format.symbles.unshift({change:(""+r[2]).length,symble:r[1]?r[1]:""});if("weight"==t){e=new RegExp("[123456]","g");var n=a.match(e);stfsk.jiazhong[t].format.decimals=n.length-6}else{e=new RegExp("[123]","g"),n=a.match(e);stfsk.jiazhong[t].format.decimals=n.length-3}},formatPrice:function(t,e){if(!stfsk.jiazhong[e].format.symbles.length)return t;if(0==t)return stfsk.jiazhong[e].format.prefix+"0"+stfsk.jiazhong[e].format.suffix;"weight"==e&&(t=stfsk.jiazhong.weight.format.decimals?parseFloat(t).toFixed(stfsk.jiazhong.weight.format.decimals):parseInt(t,10));var s=(t=t.toString().replace(/([^\d]+)/g,"")).split("").reverse(),i="",r=0;if($.each(stfsk.jiazhong[e].format.symbles,function(t,e){for(var a=0;a<e.change&&r<s.length;a++)i=s[r++]+i;r<s.length&&(i=e.symble+i)}),r<s.length)for(var a=r;a<s.length;a++)i=s[a]+i;return stfsk.jiazhong[e].format.prefix+i+stfsk.jiazhong[e].format.suffix},deFormatPrice:function(t,e){if(t=(t=t.toString().replace(stfsk.jiazhong[e].format.prefix,"")).replace(stfsk.jiazhong[e].format.suffix,""),stfsk.jiazhong[e].format.decimals){var a=t.split(stfsk.jiazhong[e].format.symbles[0].symble);if(1<a.length){var s=a.pop();t=a.join("").replace(/([^\d]+)/g,"")+"."+s}else t=t.replace(/([^\d]+)/g,"")}else t=t.replace(/([^\d]+)/g,"");return t}};